<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Scanner Documents</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
body { font-family: Arial; text-align: center; padding: 20px; }
#result { margin-top: 20px; }
img { max-width: 200px; margin: 10px auto; }
button { font-size: 18px; padding: 10px 20px; }
</style>
</head>
<body>

<h2>ğŸ“‚ Scanner un document</h2>
<div id="reader" style="width:300px;margin:auto;"></div>
<div id="result"></div>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTSbYLrGQEm2zACNACmukjohMBGn3im1fS5SZD0jjCg6m7sd6iD3XIY22a6qRJcrDwHv-WqvLYwxCmR/pub?gid=0&single=true&output=csv";

let data = [];

fetch(csvUrl)
.then(res => res.text())
.then(text => {
  data = text.split("\n").slice(1).map(l => l.split(","));
});

function onScanSuccess(code) {
  const row = data.find(r => r[0] === code);
  if (!row) {
    document.getElementById("result").innerHTML = "âŒ Code inconnu";
    return;
  }

  document.getElementById("result").innerHTML = `
    <h3>${row[1]}</h3>
    <p><b>Dossier :</b> ${row[2]}</p>
    <p><b>Statut :</b> ${row[3]}</p>
    <img src="${row[5]}">
    <br><br>
    <a href="${row[4]}" target="_blank">
      <button>ğŸ“‚ Ouvrir</button>
    </a>
  `;
}

new Html5Qrcode("reader").start(
  { facingMode: "environment" },
  { fps: 10, qrbox: 250 },
  onScanSuccess
);
</script>

</body>
</html>
