<script>
const apiUrl = "https://script.google.com/macros/s/AKfycby6y9NXRNxN_8Tn6en3-wc26_ftnTBna9N3fwtZhu7lcwPUD1NP43ibnDDBczd0QuMKcA/exec";
let data = [];

fetch(apiUrl)
  .then(res => res.json())
  .then(json => {
    data = json;
  });

function displayResult(row) {
  document.getElementById("result").innerHTML = `
    <h3>${row.Client} ‚Äì ${row.Projet}</h3>
    <p><b>Type :</b> ${row.Type}</p>
    <p><b>Intitul√© :</b> ${row.Intitul√©}</p>
    <p><b>Taille :</b> ${row.Taille}</p>
    <p><b>Mati√®re :</b> ${row.Mati√®re}</p>
    <p><b>Quantit√© :</b> ${row.Quantit√©}</p>
    <p><b>Finitions :</b> ${row.Finitions}</p>

    <img src="${row['Lien JPG']}" alt="Aper√ßu">

    <br><br>
    <a href="${row['Lien dossier Drive']}" target="_blank">
      <button>üìÇ Ouvrir le dossier</button>
    </a>
  `;
}

function searchCode(code) {
  if (!code) code = document.getElementById("codeInput").value.trim();

  const row = data.find(r => String(r.ID) === String(code));

  if (!row) {
    document.getElementById("result").innerHTML = "‚ùå Code inconnu";
    return;
  }

  displayResult(row);
  document.getElementById("codeInput").value = "";
  document.getElementById("codeInput").focus();
}

// Zapette
document.getElementById("codeInput").addEventListener("keydown", e => {
  if (e.key === "Enter") searchCode();
});

// Cam√©ra
if (/iPhone|Android/i.test(navigator.userAgent)) {
  new Html5Qrcode("reader").start(
    { facingMode: "environment" },
    {
      fps: 5,
      qrbox: { width: 300, height: 120 },
      formatsToSupport: [
        Html5QrcodeSupportedFormats.CODE_128,
        Html5QrcodeSupportedFormats.EAN_13,
        Html5QrcodeSupportedFormats.EAN_8,
        Html5QrcodeSupportedFormats.QR_CODE
      ]
    },
    searchCode
  );
}
</script>
