<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Scanner Documents</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
body { font-family: Arial; text-align: center; padding: 20px; }
#result { margin-top: 20px; }
img { max-width: 200px; margin: 10px auto; }
button { font-size: 16px; padding: 8px 15px; margin-top: 10px; }
input { font-size: 18px; padding: 10px; width: 80%; max-width: 300px; }
.box { border: 1px solid #ccc; padding: 15px; margin: 15px auto; max-width: 400px; }
</style>
</head>
<body>

<h2>üìÇ Consultation documents</h2>

<div class="box">
<h3>‚å®Ô∏è Scan zapette / clavier (Mac)</h3>
<input id="codeInput" placeholder="Scannez le code-barres ici">
<br>
<button onclick="searchCode()">Valider</button>
</div>

<div class="box">
<h3>üì∑ Scan cam√©ra (iPhone)</h3>
<div id="reader" style="width:300px;margin:auto;"></div>
</div>

<div id="result"></div>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTSbYLrGQEm2zACNACmukjohMBGn3im1fS5SZD0jjCg6m7sd6iD3XIY22a6qRJcrDwHv-WqvLYwxCmR/pub?gid=0&single=true&output=csv";
let data = [];

fetch(csvUrl)
.then(res => res.text())
.then(text => {
  data = text.split("\n").slice(1).map(l => l.split(","));
});

function displayResult(row) {
  document.getElementById("result").innerHTML = `
    <h3>${row[1]}</h3>
    <p><b>Dossier :</b> ${row[2]}</p>
    <p><b>Statut :</b> ${row[3]}</p>
    <img src="${row[5]}">
    <br><br>
    <a href="${row[4]}" target="_blank">
      <button>üìÇ Ouvrir</button>
    </a>
  `;
}

function searchCode(code) {
  if (!code) code = document.getElementById("codeInput").value.trim();
  const row = data.find(r => r[0] === code);
  if (!row) {
    document.getElementById("result").innerHTML = "‚ùå Code inconnu";
    return;
  }
  displayResult(row);
  document.getElementById("codeInput").value = "";
  document.getElementById("codeInput").focus();
}

// Zapette = Entr√©e automatique
document.getElementById("codeInput").addEventListener("keydown", e => {
  if (e.key === "Enter") searchCode();
});

// Cam√©ra (iPhone)
if (/iPhone|Android/i.test(navigator.userAgent)) {
  new Html5Qrcode("reader").start(
    { facingMode: "environment" },
    {
      fps: 5,
      qrbox: { width: 300, height: 120 },
      formatsToSupport: [
        Html5QrcodeSupportedFormats.CODE_128,
        Html5QrcodeSupportedFormats.EAN_13,
        Html5QrcodeSupportedFormats.EAN_8
      ]
    },
    searchCode
  );
}
</script>

</body>
</html>
