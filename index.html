<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Projet Complet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h2 { text-align: center; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #f4f4f4; }
  input[type="checkbox"] { transform: scale(1.2); }
  select { padding: 4px; }
  .visuel { max-width: 120px; }
  button { margin-top: 10px; padding: 6px 12px; font-size: 14px; }
</style>
</head>
<body>

<h2>üìä Suivi complet du projet</h2>

<div>
  <label for="projectID">Scanne ou saisis le QR/ID :</label>
  <input type="text" id="projectID" placeholder="Entrez l'ID ici">
  <button onclick="loadProject()">Afficher le projet</button>
</div>

<div id="projectTableContainer"></div>

<script>
// URL de ton Google Sheet JSON (publication en CSV ou JSON via AppScript)
const sheetURL = "https://script.google.com/macros/s/AKfycbziwMzMRA4rrZApjzJ39sEI7NPXkGE1z0MODoUMqKOdp3z6El5p_c0u-D5IMJVNtw3SMQ/exec";
let projectData = [];

// R√©cup√©ration de toutes les donn√©es du Sheet
fetch(sheetURL)
.then(res => res.json())
.then(data => {
    projectData = data; // data doit √™tre un tableau d'objets
})
.catch(err => console.error("Erreur r√©cup√©ration Sheet :", err));

// Fonction pour afficher le projet complet
function loadProject() {
    const id = document.getElementById("projectID").value.trim();
    if (!id) return alert("Veuillez saisir un ID.");

    // Filtrer les √©l√©ments correspondant au projet de l'ID scann√©
    const projectRows = projectData.filter(row => row.id === id);

    if (!projectRows.length) {
        document.getElementById("projectTableContainer").innerHTML = "‚ùå Projet introuvable";
        return;
    }

    // Cr√©ation du tableau HTML
    let html = '<table><tr>';
    html += "<th>Nom fichier</th><th>Visuel</th><th>PDF</th><th>JPG</th><th>QR</th><th>Re√ßu</th><th>Imprim√©</th></tr>";

    projectRows.forEach(row => {
        html += "<tr>";
        html += `<td>${row.intitule}</td>`;
        html += `<td><img class="visuel" src="${row.jpgDrive}" alt="visuel"></td>`;
        html += `<td><a href="${row.pdfDrive}" target="_blank">PDF</a></td>`;
        html += `<td><a href="${row.jpgDrive}" target="_blank">JPG</a></td>`;
        html += `<td><a href="${row.qrDrive}" target="_blank">QR</a></td>`;
        html += `<td><input type="checkbox" ${row.recu ? "checked" : ""} onchange="updateSheet('${row.id}','recu',this.checked)"></td>`;
        html += `<td><input type="checkbox" ${row.imprime ? "checked" : ""} onchange="updateSheet('${row.id}','imprime',this.checked)"></td>`;
        html += "</tr>";
    });

    html += "</table>";
    document.getElementById("projectTableContainer").innerHTML = html;
}

// Fonction pour mettre √† jour le Sheet via POST AppScript
function updateSheet(id, field, value) {
    fetch(sheetURL, {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: id, field: field, value: value })
    })
    .then(res => res.json())
    .then(res => console.log("Mise √† jour OK :", res))
    .catch(err => console.error("Erreur update Sheet :", err));
}
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Projet Complet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h2 { text-align: center; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #f4f4f4; }
  input[type="checkbox"] { transform: scale(1.2); }
  select { padding: 4px; }
  .visuel { max-width: 120px; }
  button { margin-top: 10px; padding: 6px 12px; font-size: 14px; }
</style>
</head>
<body>

<h2>üìä Suivi complet du projet</h2>

<div>
  <label for="projectID">Scanne ou saisis le QR/ID :</label>
  <input type="text" id="projectID" placeholder="Entrez l'ID ici">
  <button onclick="loadProject()">Afficher le projet</button>
</div>

<div id="projectTableContainer"></div>

<script>
// URL de ton Google Sheet JSON (publication en CSV ou JSON via AppScript)
const sheetURL = "https://script.google.com/macros/s/AKfycbziwMzMRA4rrZApjzJ39sEI7NPXkGE1z0MODoUMqKOdp3z6El5p_c0u-D5IMJVNtw3SMQ/exec";
let projectData = [];

// R√©cup√©ration de toutes les donn√©es du Sheet
fetch(sheetURL)
.then(res => res.json())
.then(data => {
    projectData = data; // data doit √™tre un tableau d'objets
})
.catch(err => console.error("Erreur r√©cup√©ration Sheet :", err));

// Fonction pour afficher le projet complet
function loadProject() {
    const id = document.getElementById("projectID").value.trim();
    if (!id) return alert("Veuillez saisir un ID.");

    // Filtrer les √©l√©ments correspondant au projet de l'ID scann√©
    const projectRows = projectData.filter(row => row.id === id);

    if (!projectRows.length) {
        document.getElementById("projectTableContainer").innerHTML = "‚ùå Projet introuvable";
        return;
    }

    // Cr√©ation du tableau HTML
    let html = '<table><tr>';
    html += "<th>Nom fichier</th><th>Visuel</th><th>PDF</th><th>JPG</th><th>QR</th><th>Re√ßu</th><th>Imprim√©</th></tr>";

    projectRows.forEach(row => {
        html += "<tr>";
        html += `<td>${row.intitule}</td>`;
        html += `<td><img class="visuel" src="${row.jpgDrive}" alt="visuel"></td>`;
        html += `<td><a href="${row.pdfDrive}" target="_blank">PDF</a></td>`;
        html += `<td><a href="${row.jpgDrive}" target="_blank">JPG</a></td>`;
        html += `<td><a href="${row.qrDrive}" target="_blank">QR</a></td>`;
        html += `<td><input type="checkbox" ${row.recu ? "checked" : ""} onchange="updateSheet('${row.id}','recu',this.checked)"></td>`;
        html += `<td><input type="checkbox" ${row.imprime ? "checked" : ""} onchange="updateSheet('${row.id}','imprime',this.checked)"></td>`;
        html += "</tr>";
    });

    html += "</table>";
    document.getElementById("projectTableContainer").innerHTML = html;
}

// Fonction pour mettre √† jour le Sheet via POST AppScript
function updateSheet(id, field, value) {
    fetch(sheetURL, {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: id, field: field, value: value })
    })
    .then(res => res.json())
    .then(res => console.log("Mise √† jour OK :", res))
    .catch(err => console.error("Erreur update Sheet :", err));
}
</script>

</body>
</html>
