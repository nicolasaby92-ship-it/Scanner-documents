<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Suivi Projet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial; margin:20px; }
table { width: 100%; border-collapse: collapse; margin-top:20px;}
th, td { border:1px solid #ccc; padding:8px; text-align:center;}
th { background:#eee;}
button { padding:5px 10px; margin:2px;}
</style>
</head>
<body>

<h2>üìÇ Suivi des projets</h2>

<table id="projectTable">
<thead>
<tr>
<th>ID</th>
<th>Client</th>
<th>Projet</th>
<th>Type</th>
<th>Intitul√©</th>
<th>Mati√®re</th>
<th>Taille</th>
<th>PDF</th>
<th>JPG</th>
<th>QR</th>
<th>Date</th>
<th>Quantit√©</th>
<th>Finitions</th>
<th>Statut</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const sheetURL = "https://script.google.com/macros/s/AKfycbxtESz9-vAUpPd9GQa-h11s_1wM2i1hsY4_vbkrkNJpt0hidn0RcFJ-Cyn3Y6VNH0bU/exec";

async function loadData() {
  const res = await fetch(sheetURL);
  const data = await res.json();
  const tbody = document.querySelector("#projectTable tbody");
  tbody.innerHTML = "";
  
  data.forEach(row => {
    const tr = document.createElement("tr");
    
    tr.innerHTML = `
      <td>${row.ID || ""}</td>
      <td>${row.CLIENT || ""}</td>
      <td>${row.PROJET || ""}</td>
      <td>${row.TYPE || ""}</td>
      <td>${row.INTITUL√â || ""}</td>
      <td>${row.MATI√àRE || ""}</td>
      <td>${row.TAILLE || ""}</td>
      <td><a href="${row.PDF || '#'}" target="_blank">PDF</a></td>
      <td><a href="${row.JPG || '#'}" target="_blank">JPG</a></td>
      <td><a href="${row.QR || '#'}" target="_blank">QR</a></td>
      <td>${row.DATE || ""}</td>
      <td>${row.QUANTIT√â || ""}</td>
      <td>${row.FINITIONS || ""}</td>
      <td>
        <select onchange="updateStatus('${row.ID}', this.value)">
          <option value="">--</option>
          <option value="Re√ßu">Re√ßu</option>
          <option value="Imprim√©">Imprim√©</option>
          <option value="Valid√©">Valid√©</option>
        </select>
      </td>
    `;
    
    tbody.appendChild(tr);
  });
}

async function updateStatus(id, status) {
  const payload = { id, status };
  try {
    const res = await fetch(sheetURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    const json = await res.json();
    console.log("Mise √† jour:", json);
    await loadData();
  } catch(err) {
    console.error("Erreur update:", err);
  }
}

// Chargement initial
loadData();
</script>

</body>
</html>
